<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=0.2">
    <!-- PAGE TITLE HERE -->
    <title>SerpomarWeb</title>
    
    <link href="/vendor/jquery-nice-select/css/nice-select.css" rel="stylesheet">
    <link rel="stylesheet" href="/vendor/nouislider/nouislider.min.css">
    <!-- Style css -->
    <link href="/css/style-Dash.css" rel="stylesheet">

    <link href="https://unpkg.com/gridjs/dist/theme/mermaid.min.css" rel="stylesheet"/>
    <link href="https://cdn.jsdelivr.net/npm/gridjs/dist/theme/mermaid.min.css" rel="stylesheet" />
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet"/>
</head>
<body>

    <!-- Contenedor para el preloader -->
    <div id="preloader-container"></div>
    <!-- Contenedor para el preloader -->

    <!-- Contenedor para el nav-header -->
    <div id="navheader-container"></div>
    <!-- Contenedor para el nav-header -->

    <div id="main-wrapper">
        <div class="header">
            <div class="header-content">
                <nav class="navbar navbar-expand">
                    <div class="collapse navbar-collapse justify-content-between">
                        <div class="header-left">
                            <div class="dashboard_bar">
                                Crear Orden de Cargue
                            </div>
                        </div>
                        <ul class="navbar-nav header-right">
                            <li class="nav-item">
                                <div class="input-group search-area">
                                    <input type="text" class="form-control" placeholder="Buscar...">
                                    <span class="input-group-text"><a href="javascript:void(0)"><i class="flaticon-381-search-2"></i></a></span>
                                </div>
                            </li>
                            <li class="nav-item">
                                <a href="javascript:void(0);" class="btn btn-primary d-sm-inline-block d-none">Generar Reporte<i class="las la-signal ms-3 scale5"></i></a>
                            </li>
                        </ul>
                    </div>
                </nav>
            </div>
        </div>

        <div id="sidebar-container"></div>

        <div class="content-body">
            <div id="content" class="p-4 p-md-5 pt-5">
                <div class="container">
                    <form id="createOrdenCargue" method="post" enctype="multipart/form-data">
                        <div class="row">
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label for="fecha_solicitud" class="form-label">Fecha de Solicitud</label>
                                    <input type="date" class="form-control" id="fecha_solicitud" name="fecha_solicitud" required>
                                </div>
                            </div>

                            <div class="col-md-4">
                                <div class="form-group">
                                    <label for="id_placa" class="form-label">Placa</label>
                                    <select id="id_placa" name="id_placa" class="form-control" required>
                                        <option value="">Seleccione una Opción</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label for="id_cliente" class="form-label">ID Cliente</label>
                                    <select id="id_cliente" name="id_cliente" class="form-control" required>
                                        <option value="">Seleccione una Opción</option>
                                    </select>
                                </div>
                            </div>
        
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label for="id_conductor" class="form-label">Conductor</label>
                                    <select id="id_conductor" name="id_conductor" class="form-control" required>
                                        <option value="">Seleccione una Opción</option>
                                        <!-- Agrega las opciones aquí -->
                                    </select>
                                </div>
                            </div>
        
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label for="modalidad" class="form-label">Modalidad</label>
                                    <input type="text" class="form-control" id="modalidad" name="modalidad" required>
                                </div>
                            </div>
        
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label for="id_tipo_operacion" class="form-label">Tipo de Servicio</label>
                                    <select id="id_tipo_operacion" name="id_tipo_operacion" class="form-control" required>
                                        <option value="">Seleccione una Opción</option>
                                        <!-- Agrega las opciones aquí -->
                                    </select>
                                </div>
                            </div>
        
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label for="id_sitio_inspeccion" class="form-label">Destino 1</label>
                                    <select id="id_sitio_inspeccion" name="id_sitio_inspeccion" class="form-control" required>
                                        <option value="">Seleccione una Opción</option>
                                        <!-- Agrega las opciones aquí -->
                                    </select>
                                </div>
                            </div>
        
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label for="id_sitio_inspeccion1" class="form-label">Destino 2</label>
                                    <select id="id_sitio_inspeccion1" name="id_sitio_inspeccion1" class="form-control">
                                        <option value="">Seleccione una Opción</option>
                                        <!-- Agrega las opciones aquí -->
                                    </select>
                                </div>
                            </div>
        
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label for="id_sitio_inspeccion2" class="form-label">Destino 3</label>
                                    <select id="id_sitio_inspeccion2" name="id_sitio_inspeccion2" class="form-control">
                                        <option value="">Seleccione una Opción</option>
                                        <!-- Agrega las opciones aquí -->
                                    </select>
                                </div>
                            </div>
        
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label for="id_naviera" class="form-label">Naviera</label>
                                    <select id="id_naviera" name="id_naviera" class="form-control" required>
                                        <option value="">Seleccione una Opción</option>
                                        <!-- Agrega las opciones aquí -->
                                    </select>
                                </div>
                            </div>
        
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label for="contenedor" class="form-label">Contenedor</label>
                                    <input type="text" class="form-control" id="contenedor" name="contenedor" required>
                                </div>
                            </div>
        
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label for="id_tipo_contenedor" class="form-label">Tipo de Contenedor</label>
                                    <select id="id_tipo_contenedor" name="id_tipo_contenedor" class="form-control" required>
                                        <option value="">Seleccione una Opción</option>
                                        <!-- Agrega las opciones aquí -->
                                    </select>
                                </div>
                            </div>
        
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label for="peso" class="form-label">Peso</label>
                                    <input type="number" step="0.01" class="form-control" id="peso" name="peso" required>
                                </div>
                            </div>
        
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label for="funcionario_transporte" class="form-label">Funcionario de Transporte</label>
                                    <input type="text" class="form-control" id="funcionario_transporte" name="funcionario_transporte" required>
                                </div>
                            </div>
        
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label for="precinto" class="form-label">Precinto</label>
                                    <input type="text" class="form-control" id="precinto" name="precinto" required>
                                </div>
                            </div>
        
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label for="vencimiento_cutoff" class="form-label">Vencimiento Cut Off</label>
                                    <input type="date" class="form-control" id="vencimiento_cutoff" name="vencimiento_cutoff" required>
                                </div>
                            </div>
        
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label for="hora_soli" class="form-label">Hora de Solicitud</label>
                                    <input type="time" class="form-control" id="hora_soli" name="hora_soli" required>
                                </div>
                            </div>
        
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label for="fecha_soli" class="form-label">Fecha de Solicitud</label>
                                    <input type="date" class="form-control" id="fecha_soli" name="fecha_soli" required>
                                </div>
                            </div>
        
                            <div class="col-md-12">
                                <div class="form-group">
                                    <label for="observaciones" class="form-label">Observaciones</label>
                                    <textarea class="form-control" id="observaciones" name="observaciones" rows="3"></textarea>
                                </div>
                            </div>
                        </div>
        
                        <br>
                        <div class="row">
                            <div class="col-12 d-flex justify-content-between">
                                <a class="btn btn-primary" href="/view/preventas/index.html">Volver</a>
                                <button class="btn btn-primary" id="BtnSavePlaca">Enviar</button>
                                <button type="button" class="btn btn-secondary" id="generateQR">Generar QR</button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
            <div class="container">
                <div id="orden_cargue"></div>
            </div>
        </div>
        
        <!-- QR Code Modal -->
        <div class="modal" id="qrModal" tabindex="-1" role="dialog">
            <div class="modal-dialog modal-dialog-centered" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">QR - Orden de Cargue</h5>
                    </div>
                    <div class="modal-body" id="qrcode" style="text-align: center;"></div>
                    <div class="modal-footer justify-content-center">
                        <button type="button" class="btn btn-secondary" id="downloadQR">Descargar QR</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.bundle.min.js"></script>
    <script src="/componentes/loadSidebar.js"></script>
    <script src="/componentes/loadPreloader.js"></script>
    <script src="/componentes/loadNavHeader.js"></script>
    <!-- Required vendors -->
    <script src="/vendor/global/global.min.js"></script>
    <script src="/vendor/chart.js/Chart.bundle.min.js"></script>
    <script src="/vendor/jquery-nice-select/js/jquery.nice-select.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcode-generator/1.4.4/qrcode.min.js"></script>
    <!-- Apex Chart -->
    <script src="/vendor/apexchart/apexchart.js"></script>
    <script src="/vendor/nouislider/nouislider.min.js"></script>
    <script src="/vendor/wnumb/wNumb.js"></script>
    <!-- Dashboard 1 -->
    <script src="/js/dashboard/dashboard-1.js"></script>
    <script src="/js/custom.min.js"></script>
    <script src="/js/dlabnav-init.js"></script>
    <script src="/js/demo.js"></script>
    <script src="/js/styleSwitcher.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/gridjs/dist/gridjs.umd.js"></script>
    <script type="text/javascript" src="/js/patio/create.js"></script>
    <script type="text/javascript" src="/js/cargar/cargarPlaca.js"></script>
    <script type="text/javascript" src="/js/cargar/cargarClientes.js"></script>
    <script type="text/javascript" src="/js/cargar/cargarConductores.js"></script>
    <script type="text/javascript" src="/js/cargar/cargarTipoServicio.js"></script>
    <script type="text/javascript" src="/js/cargar/cargarDestino.js"></script>
    <script type="text/javascript" src="/js/cargar/cargarDestino1.js"></script>
    <script type="text/javascript" src="/js/cargar/cargarDestino2.js"></script>
    <script type="text/javascript" src="/js/cargar/cargarNaviera.js"></script>
    <script type="text/javascript" src="/js/cargar/CargarTipoContenedor.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <!-- QR Code generation script -->
    <script>
        document.getElementById('generateQR').addEventListener('click', function(event) {
            event.preventDefault();

            // Check if all required fields are filled
            var requiredFields = document.querySelectorAll('#createOrdenCargue [required]');
            var allFieldsFilled = true;
            requiredFields.forEach(function(field) {
                if (!field.value) {
                    allFieldsFilled = false;
                }
            });

            if (!allFieldsFilled) {
                alert('Por favor, complete todos los campos requeridos.');
                return;
            }

            function getSelectedText(id) {
                var select = document.getElementById(id);
                return select.options[select.selectedIndex].text;
            }

            var fechaSolicitud = document.getElementById('fecha_solicitud').value;
            var idPlaca = getSelectedText('id_placa');
            var idCliente = getSelectedText('id_cliente');
            var idConductor = getSelectedText('id_conductor');
            var modalidad = document.getElementById('modalidad').value;
            var idTipoOperacion = getSelectedText('id_tipo_operacion');
            var idDestino1 = getSelectedText('id_sitio_inspeccion');
            var idDestino2 = getSelectedText('id_sitio_inspeccion1');
            var idDestino3 = getSelectedText('id_sitio_inspeccion2');
            var idNaviera = getSelectedText('id_naviera');
            var contenedor = document.getElementById('contenedor').value;
            var idTipoContenedor = getSelectedText('id_tipo_contenedor');
            var peso = document.getElementById('peso').value;
            var funcionarioTransporte = document.getElementById('funcionario_transporte').value;
            var precinto = document.getElementById('precinto').value;
            var vencimientoCutofi = document.getElementById('vencimiento_cutoff').value;
            var horaSoli = document.getElementById('hora_soli').value;
            var fechaSoli = document.getElementById('fecha_soli').value;
            var observaciones = document.getElementById('observaciones').value;

            var qrData = `
                Fecha de Solicitud: ${fechaSolicitud}
                Placa: ${idPlaca}
                ID Cliente: ${idCliente}
                Conductor: ${idConductor}
                Modalidad: ${modalidad}
                Tipo de Servicio: ${idTipoOperacion}
                Destino 1: ${idDestino1}
                Destino 2: ${idDestino2}
                Destino 3: ${idDestino3}
                Naviera: ${idNaviera}
                Contenedor: ${contenedor}
                Tipo de Contenedor: ${idTipoContenedor}
                Peso: ${peso}
                Funcionario de Transporte: ${funcionarioTransporte}
                Precinto: ${precinto}
                Vencimiento Cut Off: ${vencimientoCutofi}
                Hora de Solicitud: ${horaSoli}
                Fecha de Solicitud: ${fechaSoli}
                Observaciones: ${observaciones}
            `;

            var qr = qrcode(0, 'L');
            qr.addData(qrData);
            qr.make();
            document.getElementById('qrcode').innerHTML = qr.createImgTag();
            
            // Show the modal
            $('#qrModal').modal('show');
        });

        // Ensure the modal can be closed properly
        $('#qrModal').on('hidden.bs.modal', function (e) {
            document.getElementById('qrcode').innerHTML = '';
        });

        // Download QR Code as image
        document.getElementById('downloadQR').addEventListener('click', function() {
            var qrImg = document.querySelector('#qrcode img');
            var qrCanvas = document.createElement('canvas');
            var context = qrCanvas.getContext('2d');
            var qrImgWidth = qrImg.width;
            var qrImgHeight = qrImg.height;
            var titleHeight = 40;
            qrCanvas.width = qrImgWidth;
            qrCanvas.height = qrImgHeight + titleHeight;

            // Add title above the QR code
            context.font = "20px Arial";
            context.textAlign = "center";
            context.fillText("Orden de Cargue", qrCanvas.width / 2, 30);

            // Draw QR code
            context.drawImage(qrImg, 0, titleHeight, qrImgWidth, qrImgHeight);

            var link = document.createElement('a');
            link.href = qrCanvas.toDataURL("image/png");
            link.download = 'qr_code.png';
            link.click();
        });
    </script>
</body>
</html>
